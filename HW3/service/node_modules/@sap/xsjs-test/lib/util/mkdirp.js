var mFs = require('fs')
var mPath = require('path')


function mkdirp(path, callback){
    mFs.exists(path, function(bExists){
        if(!bExists){
            var oPath = mPath.parse(path)
            mkdirp(oPath.dir, function(err){
                if(err){
                    callback(err)
                }else{
                    mFs.mkdir(path, function(err){
                        callback(err)
                    })
                }
            })
        }else{
            mFs.stat(path, function(stats){
                if(stats.isDirectory()){
                    callback()
                }else{
                    callback('Path exists but is not a directory:' + path)
                }
            })
        }

    })
}



function mkdirpSync(path){
    if(mFs.existsSync(path)){
        var stats = mFs.statSync(path)
        if(!stats.isDirectory()){
            throw new Error('Path exists but is not a directory:' + path)
        }
    }else{
        var dir = mPath.dirname(path)
        mkdirpSync(dir)
        mFs.mkdirSync(path)
    }
}


module.exports = {
    mkdirp : mkdirp,
    mkdirpSync : mkdirpSync
}