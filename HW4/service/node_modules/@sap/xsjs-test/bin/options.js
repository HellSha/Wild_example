/**
 * Created on 21.10.2015.
 */

module.exports = function exportOptions(argv){
    var options = {}

    function set(key, value){
        var _key = key.split('\.')
        var lastkey = _key.pop()

        var o = options
        _key.forEach(function(e){
            o = o[e] = o[e] || {}
        })

        value = value || true
        o[lastkey] = value;
    }

    for(var i=0;i<argv.length;i++){
        var re = /--([\w\.]+)=(.*)/.exec(argv[i])
        if(re) {
            var key = re[1]
            var value = re[2]
            if (value[0] !== '"') {
                value = value.split(',')
                if(value.length===1){
                    value = value[0]
                }
            }
            set(key, value)
        }else{
            throw new Error("Unexpected cmd element" + argv[i])
        }
    }//for

    return options
}
