var expect = require('expect.js');
var Fileset = require('../lib/fileset.js');

// According to http://ant.apache.org/manual/dirtasks.html#patterns
//
//  **/abc/*
//  Matches:
//  abc/folder
//  com/org/abc/Something
//  com/org/utils/node/abc/MoreStuff

describe('fileset.js tests', function(){
    it('include test', function(){
        var fpath1 = "/sap/hana/epm/shine/procedures/my_proc.xsjslib";
        var fpath2 = "procedures/my_proc.xsjslib";

        var fpath3 = "/sap/hana/epm/shine/procedure/my_proc.xsjslib";
        var fpath4 = "/sap/hana/epm/shine/procedures/my_xsjs.xsjs";
        var fpath5 = "/sap/hana/common/procedures/subprocs/my_proc.xsjslib";
        var fileset = new Fileset('**/procedures/*.xsjslib');
        expect( fileset.test(fpath1)).to.be(true);
        expect( fileset.test(fpath2)).to.be(true);

        expect( fileset.test(fpath3)).to.be(false);
        expect( fileset.test(fpath4)).to.be(false);
        expect( fileset.test(fpath5)).to.be(false);
    });

    it('exclude test', function(){
        var fpath1 = "/sap/hana/epm/shine/services/my_svc.xsjslib";
        var fpath2 = "/sap/hana/epm/shine/services/subsvc/my_proc.xsjslib";
        var fpath3 = "/sap/hana/epm/shine/procedures/my_pric.xsjslib";

        var fileset = new Fileset('**/*.xsjslib','**/services/**');
        expect( fileset.test(fpath1)).to.be(false);
        expect( fileset.test(fpath2)).to.be(false);
        expect( fileset.test(fpath3)).to.be(true);
    });

    it('include dir test', function(){
        var fpath1 = "/sap/hana/epm/shine/procedures/my_proc.xsjslib";
        var fpath2 = "procedures/my_proc.xsjslib";

        var fpath3 = "/sap/hana/epm/shine/procedures/sub/my_proc.xsjslib";
        var fpath4 = "/sap/hana/common/services/my_proc.xsjslib";
        var fpath5 = "/sap/hana/common/procedures/services/my_proc.xsjslib";

        var fileset = new Fileset('**/procedures/**/*.xsjslib','**/services/**');
        expect( fileset.test(fpath1)).to.be(true);
        expect( fileset.test(fpath2)).to.be(true);

        expect( fileset.test(fpath3)).to.be(true);
        expect( fileset.test(fpath4)).to.be(false);
        expect( fileset.test(fpath5)).to.be(false);
    });
});