#!/usr/bin/env node

var fs = require('fs')
var xsjstest = require('@sap/xsjs-test')
var xsenv = require('@sap/xsenv')
var fnOptions = require('./options.js')
var _ = require('lodash')

var options = xsenv.getServices({hana:{tag:'hana'}})

var default_options =  {
    test : {
        format: 'json',
        pattern: '.*[Tt]est$'
    },
    coverage : false
}

var xstest_options
try{
    xstest_options = fs.readFileSync('./test/xstest.json')
    xstest_options = JSON.parse(xstest_options)
}catch(x){
}

var proc_options = fnOptions(process.argv.slice(2))

_.merge(options, default_options, xstest_options,proc_options)

var testapp = xsjstest(options)
// Execute tests on the command line and exit
testapp.runTests()